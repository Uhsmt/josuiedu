<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stirring Vortex</title>
<style>
  :root{
    --vortex-color: #2aa7df;   /* 渦の色 */
    --vortex-width: 4;          /* 線の太さ(px) */
    --flow-speed: 1.1s;         /* 流れの速さ（数値↓で速く） */
    --dash: 18;                 /* 破線ピッチ（見た目の粒度） */
    --gap: 10;                  /* 破線の隙間 */
  }

  html,body{ height:100%; }
  body{
    margin:0; display:grid; place-items:center; height:100dvh;
    background:#8a6412; /* 背景＝容器の外側（お好みで） */
    font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", sans-serif;
  }

  .stage{ width:min(64vmin,560px); aspect-ratio: 3 / 5; }

  @keyframes flow { to { stroke-dashoffset: calc(var(--dash) + var(--gap) * -1); } }

  .vortex {
    fill:none; stroke: var(--vortex-color); stroke-width: var(--vortex-width);
    stroke-linecap: round; stroke-linejoin: round;
    stroke-dasharray: var(--dash) var(--gap);
    animation: flow var(--flow-speed) linear infinite;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,.15));
  }
</style>
</head>
<body>
  <svg class="stage" viewBox="0 0 300 500" role="img" aria-label="stirring vortex animation">
    <defs>
      <clipPath id="jar-clip-user">
        <path d="
          M 40 40
          L 260 40
          L 260 360
          L 205 360
          L 205 410
          L 95 410
          L 95 360
          L 40 360 Z
        " />
      </clipPath>
    </defs>

    <g clip-path="url(#jar-clip-user)">
      <path id="vortex-path" class="vortex" d="M150,60" />
    </g>
  </svg>

<script>
(function makeVortex(){
  const pathEl = document.getElementById('vortex-path');

  const cx = 150, topY = 70, bottomY = 350;     // 中心X、上端Y、下端Y
  const rTop = 110, rBottom = 14;               // 上端半径、下端半径
  const turns = 9.5;                            // 周回数
  const pointsPerTurn = 90;                     // 分解能
  const easing = t => t;                        // 半径の落ち方

  const totalPoints = Math.max(50, Math.floor(pointsPerTurn * turns));
  const ySpan = bottomY - topY;

  let d = "";
  for (let i = 0; i <= totalPoints; i++) {
    const t = i / totalPoints;               // 0..1（上→下）
    const y = topY + ySpan * t;
    const radius = rTop + (rBottom - rTop) * easing(t);
    const theta = (turns * 2 * Math.PI) * t;
    const x = cx + Math.cos(theta) * radius;
    if (i === 0) d += `M ${x.toFixed(2)} ${y.toFixed(2)}`;
    else         d += ` L ${x.toFixed(2)} ${y.toFixed(2)}`;
  }
  pathEl.setAttribute("d", d);
})();
</script>
</body>
</html>
